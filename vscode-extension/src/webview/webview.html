<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${webview.cspSource} 'unsafe-inline'; script-src ${webview.cspSource}; img-src ${webview.cspSource} data:;">
    <title>Code Map</title>
    <link rel="stylesheet" href="${stylesUri}">
    <link rel="stylesheet" href="${diffStylesUri}">
</head>
<body>
    <div id="app">
        <!-- Toolbar -->
        <div id="toolbar">
            <div class="toolbar-section">
                <span class="toolbar-label">Metrics Layer:</span>
                <div class="button-group">
                    <button class="layer-btn active" data-layer="none">None</button>
                    <button class="layer-btn" data-layer="coverage">Coverage</button>
                    <button class="layer-btn" data-layer="loc">LOC</button>
                    <button class="layer-btn" data-layer="complexity">Complexity</button>
                </div>
            </div>
            <div class="toolbar-section">
                <span class="toolbar-label">Layout:</span>
                <div class="button-group">
                    <button class="layout-btn active" data-layout="hierarchical">Hierarchical</button>
                    <button class="layout-btn" data-layout="force-directed">Force</button>
                </div>
            </div>
            <div class="toolbar-section">
                <button id="refresh-btn" class="action-btn" title="Refresh Graph">
                    ⟳ Refresh
                </button>
                <button id="send-btn" class="action-btn primary" title="Send Selection to Agent (Ctrl+Enter)">
                    → Send to Agent
                </button>
            </div>
            <div class="toolbar-section selection-info">
                <span id="selection-count">0 selected</span>
            </div>
            <div class="toolbar-section" id="baseline-section" style="display: none;">
                <span class="baseline-badge">
                    <span class="baseline-type" id="baseline-type"></span>
                    <span class="baseline-ref" id="baseline-ref"></span>
                </span>
            </div>
        </div>

        <!-- Graph Container -->
        <div id="graph-container"></div>

        <!-- Status Bar -->
        <div id="status-bar">
            <span id="status-nodes">Nodes: 0</span>
            <span id="status-edges">Edges: 0</span>
            <span id="status-zoom">Zoom: 100%</span>
            <span id="status-cluster">Clustering: Auto</span>
        </div>

        <!-- Legend -->
        <div id="legend">
            <div class="legend-title">Node Types</div>
            <div class="legend-item">
                <span class="legend-color" style="background: #e8e8e8; border-color: #999999;"></span>
                <span>Directory</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #d4e5f7; border-color: #4a90d9;"></span>
                <span>File</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #d4f7d4; border-color: #4a9d4a;"></span>
                <span>Class</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #f7e6d4; border-color: #d99a4a;"></span>
                <span>Interface</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #e6d4f7; border-color: #9a4ad9;"></span>
                <span>Function</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #f7d4e6; border-color: #d94a9a;"></span>
                <span>Method</span>
            </div>
        </div>

        <!-- Coverage Legend (shown when coverage layer is active) -->
        <div id="coverage-legend" class="hidden">
            <div class="legend-title">Coverage</div>
            <div class="gradient-bar"></div>
            <div class="gradient-labels">
                <span>0%</span>
                <span>50%</span>
                <span>100%</span>
            </div>
        </div>
    </div>

    <script src="${scriptUri}"></script>
</body>
</html>
